name: 'AuthSnitch Security Review'
description: 'Monitors pull requests for authentication-related changes and alerts security teams when manual review may be needed'
author: 'Your Organization'

branding:
  icon: 'shield'
  color: 'blue'

inputs:
  github_token:
    description: 'GitHub token for API access'
    required: true

  anthropic_api_key:
    description: 'Claude API key for detection and summarization'
    required: true

  # Notification channels
  slack_webhook_url:
    description: 'Slack incoming webhook URL'
    required: false
  teams_webhook_url:
    description: 'Microsoft Teams webhook URL'
    required: false
  post_pr_comment:
    description: 'Post findings as a PR comment'
    default: 'false'

  # Signal configuration
  notify_on_claude_only:
    description: 'Notify when only Claude detects auth changes but no keywords match'
    default: 'false'
  notify_on_keywords_only:
    description: 'Notify when only keywords match but Claude does not detect auth changes'
    default: 'false'

  # Customization
  custom_keywords:
    description: 'Additional keywords to detect (comma-separated)'
    required: false
  detection_prompt:
    description: 'Custom detection prompt (overrides default)'
    required: false
  detection_config_path:
    description: 'Path to custom detection.yml in repo'
    required: false

runs:
  using: 'docker'
  image: 'Dockerfile'
  env:
    GITHUB_TOKEN: ${{ inputs.github_token }}
    ANTHROPIC_API_KEY: ${{ inputs.anthropic_api_key }}
    SLACK_WEBHOOK_URL: ${{ inputs.slack_webhook_url }}
    TEAMS_WEBHOOK_URL: ${{ inputs.teams_webhook_url }}
    POST_PR_COMMENT: ${{ inputs.post_pr_comment }}
    NOTIFY_ON_CLAUDE_ONLY: ${{ inputs.notify_on_claude_only }}
    NOTIFY_ON_KEYWORDS_ONLY: ${{ inputs.notify_on_keywords_only }}
    CUSTOM_KEYWORDS: ${{ inputs.custom_keywords }}
    DETECTION_PROMPT: ${{ inputs.detection_prompt }}
    DETECTION_CONFIG_PATH: ${{ inputs.detection_config_path }}
